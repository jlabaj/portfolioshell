rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Servers collection rules - handles /servers/{serverId}
    match /servers/{serverId} {
      // Allow read access to all server documents
      allow read: if true;
      
      // Allow write access to all server documents
      // Note: For production, consider adding authentication checks:
      // allow write: if request.auth != null;
      allow create, update, delete: if true;
      
      // Handle nested subcollections if they exist
      match /{subcollection=**} {
        allow read, write: if true;
      }
    }
    
    // ServersTree document - allow reads, writes only from server-side (functions)
    // Client can read but not write directly
    match /servers/serversTree {
      allow read: if true;
      // Writes are handled by Cloud Functions, so we can restrict client writes
      // If you need client writes, change to: allow write: if true;
      allow write: if false;
    }
    
    // Catch-all rule for any other nested paths (e.g., servers/servers/servers)
    // This ensures all paths are covered
    match /{path=**} {
      allow read, write: if true;
    }
  }
}
